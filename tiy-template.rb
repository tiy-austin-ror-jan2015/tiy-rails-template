VERSION = 'v1.1.0'
def get(prompt)
  yes?(prompt + ' (y/n) >')
end

#heroku gems
gem 'puma'
gem 'rails_12factor'
#
puts 'Creating Procfile'
file 'Procfile',<<-CODE
  web: bundle exec puma -t 5:5 -p ${PORT:-3000} -e ${RACK_ENV:-development}
CODE


gem_group :test, :development do
  gem 'faker'

  if get('Would you like to use the better errors gem?')
    gem 'better_errors'
    gem 'binding_of_caller'
  end
end

gem 'bootstrap-sass'

if get('Would you like to use Simple Form?')
  gem 'simple_form'
  generate('simple_form:install --bootstrap')
end

puts 'Creating application.scss'

file 'app/assets/stylesheets/application.scss', <<-CODE
@import 'bootstrap-sprockets';
@import 'bootstrap';
CODE

puts 'Linking to bootstrap files'

run 'rm app/assest/stylesheets/application.css'

puts 'Removing old application.css file'


after_bundle do
  if get('Would you like to create a new git repo and add everything to it?')
    git :init
    git add: '--all'
    git commit: "-a -m 'Initial Commit [Generated by TIY Rails Template (#{VERSION})]'"

    if get('Would you like to push your git repo to github?')
      run('hub create')
      git push: '-u origin master'
      if get('Would you like to open your newly created repo on github?')
        remote = `git remote -v`
        unless remote.empty?
          url_pieces = remote.scan(/github\.com:(.*)\.git/)
          url = "https://github.com/#{url_pieces.first.first}"
          run("open #{url}")
        end
      end
    end
  end
  rake('db:create') if get('Would you like to create your db with `rake db:create`')
  yes?('Complete! Your new rails app is finished and ready to go')
end

